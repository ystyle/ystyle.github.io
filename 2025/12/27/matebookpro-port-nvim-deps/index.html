<!DOCTYPE html>
<html>
<head>
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?10658703a526f24446a8cbedef8d287f"></script>
<!-- End Baidu Tongji -->



<!-- Baidu Push -->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- End Baidu Push -->


    <meta charset="utf-8">
    
    
    
    <title>Neovim移植鸿蒙PC：三方库适配实战与挑战解析 | 东方星痕 | 请你给我力量，给我方向， 用风一样的翅膀，更用力的飞翔.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="鸿蒙,鸿蒙PC,matebook pro,neovim,livub,luajit">
    <meta name="description" content="Neovim移植鸿蒙PC：三方库适配实战与挑战解析 本文记录将Neovim编辑器移植到HarmonyOS PC过程中，对11个核心依赖库的适配实战经验，涵盖平台差异分析、API限制处理、构建系统改造等关键问题。  项目背景目标：将现代文本编辑器Neovim完整移植到HarmonyOS PC系统，支持完整的Lua插件生态和现代语法高亮。 环境：  操作系统：HarmonyOS 6.0 架构：aarc">
<meta name="keywords" content="鸿蒙,鸿蒙PC,matebook pro,neovim,livub,luajit">
<meta property="og:type" content="article">
<meta property="og:title" content="Neovim移植鸿蒙PC：三方库适配实战与挑战解析">
<meta property="og:url" content="http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/index.html">
<meta property="og:site_name" content="东方星痕">
<meta property="og:description" content="Neovim移植鸿蒙PC：三方库适配实战与挑战解析 本文记录将Neovim编辑器移植到HarmonyOS PC过程中，对11个核心依赖库的适配实战经验，涵盖平台差异分析、API限制处理、构建系统改造等关键问题。  项目背景目标：将现代文本编辑器Neovim完整移植到HarmonyOS PC系统，支持完整的Lua插件生态和现代语法高亮。 环境：  操作系统：HarmonyOS 6.0 架构：aarc">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2025-12-27T11:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Neovim移植鸿蒙PC：三方库适配实战与挑战解析">
<meta name="twitter:description" content="Neovim移植鸿蒙PC：三方库适配实战与挑战解析 本文记录将Neovim编辑器移植到HarmonyOS PC过程中，对11个核心依赖库的适配实战经验，涵盖平台差异分析、API限制处理、构建系统改造等关键问题。  项目背景目标：将现代文本编辑器Neovim完整移植到HarmonyOS PC系统，支持完整的Lua插件生态和现代语法高亮。 环境：  操作系统：HarmonyOS 6.0 架构：aarc">
    
        <link rel="alternate" type="application/atom+xml" title="东方星痕" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/avatar.jpg">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">YSTYLE</h5>
          <a href="mailto:lxy5266@live.com" title="lxy5266@live.com" class="mail">lxy5266@live.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ystyle" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                项目
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/512308314" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                微博
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-rss"></i>
                订阅
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friends"  >
                <i class="icon icon-lg icon-link"></i>
                友链
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Neovim移植鸿蒙PC：三方库适配实战与挑战解析</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Neovim移植鸿蒙PC：三方库适配实战与挑战解析</h1>
        <h5 class="subtitle">
            
                <time datetime="2025-12-27T11:00:00.000Z" itemprop="datePublished" class="page-time">
  2025-12-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/软件/">软件</a></li></ul>

            
        </h5>
    </div>

    

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Neovim移植鸿蒙PC：三方库适配实战与挑战解析"><span class="post-toc-number">1.</span> <span class="post-toc-text">Neovim移植鸿蒙PC：三方库适配实战与挑战解析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#项目背景"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">项目背景</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、依赖库适配全景"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">一、依赖库适配全景</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-适配状态总览"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">1.1 适配状态总览</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、关键技术挑战与解决方案"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">二、关键技术挑战与解决方案</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-1-libuv：异步I-O库的鸿蒙适配"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">2.1 libuv：异步I/O库的鸿蒙适配</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#挑战分析"><span class="post-toc-number">1.3.1.1.</span> <span class="post-toc-text">挑战分析</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#解决方案"><span class="post-toc-number">1.3.1.2.</span> <span class="post-toc-text">解决方案</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#验证结果"><span class="post-toc-number">1.3.1.3.</span> <span class="post-toc-text">验证结果</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-2-LuaJIT：JIT编译器的安全限制"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">2.2 LuaJIT：JIT编译器的安全限制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#挑战分析-1"><span class="post-toc-number">1.3.2.1.</span> <span class="post-toc-text">挑战分析</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#解决方案-1"><span class="post-toc-number">1.3.2.2.</span> <span class="post-toc-text">解决方案</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#性能影响"><span class="post-toc-number">1.3.2.3.</span> <span class="post-toc-text">性能影响</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-构建系统适配"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">2.3 构建系统适配</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#挑战分析-2"><span class="post-toc-number">1.3.3.1.</span> <span class="post-toc-text">挑战分析</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#统一构建方案"><span class="post-toc-number">1.3.3.2.</span> <span class="post-toc-text">统一构建方案</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-4-头文件与路径冲突"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">2.4 头文件与路径冲突</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#luv的头文件路径问题"><span class="post-toc-number">1.3.4.1.</span> <span class="post-toc-text">luv的头文件路径问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-5-平台检测扩展"><span class="post-toc-number">1.3.5.</span> <span class="post-toc-text">2.5 平台检测扩展</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#libiconv的config-guess问题"><span class="post-toc-number">1.3.5.1.</span> <span class="post-toc-text">libiconv的config.guess问题</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、适配策略总结"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">三、适配策略总结</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-渐进式适配策略"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">3.1 渐进式适配策略</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-测试驱动开发"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">3.2 测试驱动开发</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-文档与补丁管理"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text">3.3 文档与补丁管理</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、经验教训与最佳实践"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">四、经验教训与最佳实践</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-1-关键经验"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">4.1 关键经验</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-2-最佳实践"><span class="post-toc-number">1.5.2.</span> <span class="post-toc-text">4.2 最佳实践</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-3-调试技巧"><span class="post-toc-number">1.5.3.</span> <span class="post-toc-text">4.3 调试技巧</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#五、成果与展望"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">五、成果与展望</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-1-移植成果"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">5.1 移植成果</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-2-代码质量"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text">5.2 代码质量</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-3-未来工作"><span class="post-toc-number">1.6.3.</span> <span class="post-toc-text">5.3 未来工作</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#六、结语"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">六、结语</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-matebookpro-port-nvim-deps"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Neovim移植鸿蒙PC：三方库适配实战与挑战解析</h1>
        <div class="post-meta">
            <time class="post-time" title="2025-12-27 19:00:00" datetime="2025-12-27T11:00:00.000Z"  itemprop="datePublished">2025-12-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/软件/">软件</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Neovim移植鸿蒙PC：三方库适配实战与挑战解析"><a href="#Neovim移植鸿蒙PC：三方库适配实战与挑战解析" class="headerlink" title="Neovim移植鸿蒙PC：三方库适配实战与挑战解析"></a>Neovim移植鸿蒙PC：三方库适配实战与挑战解析</h1><blockquote>
<p>本文记录将Neovim编辑器移植到HarmonyOS PC过程中，对11个核心依赖库的适配实战经验，涵盖平台差异分析、API限制处理、构建系统改造等关键问题。</p>
</blockquote>
<h2 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h2><p><strong>目标</strong>：将现代文本编辑器Neovim完整移植到HarmonyOS PC系统，支持完整的Lua插件生态和现代语法高亮。</p>
<p><strong>环境</strong>：</p>
<ul>
<li>操作系统：HarmonyOS 6.0</li>
<li>架构：aarch64 (ARM64)</li>
<li>编译器：BiSheng Clang 15.0.4 (OHOS工具链)</li>
<li>构建系统：CMake 3.28.2 + Ninja</li>
</ul>
<p><strong>挑战</strong>：Neovim依赖11个核心三方库，每个库都需要针对HarmonyOS进行适配，涉及平台检测、API限制、内存权限、文件系统等多个维度。</p>
<h2 id="一、依赖库适配全景"><a href="#一、依赖库适配全景" class="headerlink" title="一、依赖库适配全景"></a>一、依赖库适配全景</h2><h3 id="1-1-适配状态总览"><a href="#1-1-适配状态总览" class="headerlink" title="1.1 适配状态总览"></a>1.1 适配状态总览</h3><table>
<thead>
<tr>
<th>依赖库</th>
<th>版本</th>
<th>适配状态</th>
<th>主要挑战</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>libuv</strong></td>
<td>1.51.0</td>
<td>✅ 完全适配</td>
<td>TTY权限、CPU亲和性、io_uring</td>
<td>条件编译+鸿蒙平台文件</td>
</tr>
<tr>
<td><strong>LuaJIT</strong></td>
<td>2.1</td>
<td>✅ 完全适配</td>
<td>JIT内存权限、系统分配器</td>
<td>禁用JIT+系统分配器</td>
</tr>
<tr>
<td><strong>Lua</strong></td>
<td>5.1.5</td>
<td>✅ 完全适配</td>
<td>工具链适配</td>
<td>Makefile平台扩展</td>
</tr>
<tr>
<td><strong>tree-sitter</strong></td>
<td>核心库</td>
<td>✅ 无需修改</td>
<td>无</td>
<td>直接构建</td>
</tr>
<tr>
<td><strong>luv</strong></td>
<td>1.51.0-1</td>
<td>✅ 完全适配</td>
<td>头文件路径冲突</td>
<td>路径修复+编译标志</td>
</tr>
<tr>
<td><strong>lpeg</strong></td>
<td>1.1.0</td>
<td>✅ 完全适配</td>
<td>Makefile工具链</td>
<td>完整Makefile重写</td>
</tr>
<tr>
<td><strong>libiconv</strong></td>
<td>1.17</td>
<td>✅ 完全适配</td>
<td>平台检测缺失</td>
<td>config.guess扩展</td>
</tr>
<tr>
<td><strong>unibilium</strong></td>
<td>v2.1.2</td>
<td>✅ 无需修改</td>
<td>无</td>
<td>直接构建</td>
</tr>
<tr>
<td><strong>utf8proc</strong></td>
<td>v2.11.2</td>
<td>✅ 无需修改</td>
<td>无</td>
<td>直接构建</td>
</tr>
<tr>
<td><strong>lua-compat-5.3</strong></td>
<td>v0.13</td>
<td>✅ 完全适配</td>
<td>缺少构建系统</td>
<td>CMakeLists.txt创建</td>
</tr>
<tr>
<td><strong>tree-sitter解析器</strong></td>
<td>7个</td>
<td>✅ 完全适配</td>
<td>无</td>
<td>直接构建</td>
</tr>
</tbody>
</table>
<p><strong>构建成功率</strong>：100% (11/11个依赖成功构建)</p>
<h2 id="二、关键技术挑战与解决方案"><a href="#二、关键技术挑战与解决方案" class="headerlink" title="二、关键技术挑战与解决方案"></a>二、关键技术挑战与解决方案</h2><h3 id="2-1-libuv：异步I-O库的鸿蒙适配"><a href="#2-1-libuv：异步I-O库的鸿蒙适配" class="headerlink" title="2.1 libuv：异步I/O库的鸿蒙适配"></a>2.1 libuv：异步I/O库的鸿蒙适配</h3><h4 id="挑战分析"><a href="#挑战分析" class="headerlink" title="挑战分析"></a>挑战分析</h4><p>libuv是Neovim异步事件处理的核心，但在HarmonyOS上遇到多个问题：</p>
<ol>
<li><strong>TTY权限问题</strong>：<code>uv_tty_init</code>在非终端环境返回<code>UV_EACCES</code></li>
<li><strong>CPU亲和性API缺失</strong>：HarmonyOS缺少<code>pthread_setaffinity_np</code>等API</li>
<li><strong>mmsghdr结构体差异</strong>：系统头文件定义不完整</li>
<li><strong>io_uring支持</strong>：可能不兼容</li>
</ol>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p><strong>平台检测与条件编译</strong>：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在CMakeLists.txt中添加鸿蒙平台定义</span></span><br><span class="line">add_definitions(-D__OHOS__=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键API的条件编译包装</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(__OHOS__)</span></span><br><span class="line"><span class="comment">// Linux特有功能（CPU亲和性、mmsghdr等）</span></span><br><span class="line">uv_cpumask_size();</span><br><span class="line">uv_available_parallelism();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>创建鸿蒙平台文件</strong>：<br>基于<code>linux.c</code>创建<code>harmonyos.c</code>，包含：</p>
<ul>
<li>完整的<code>uv__platform_loop_init</code>实现</li>
<li>epoll事件循环支持</li>
<li>缺失函数的桩实现</li>
</ul>
<p><strong>TTY功能验证</strong>：<br>在真实终端环境中测试，发现<code>isatty()</code>在HarmonyOS上正常工作，所有TTY函数（<code>uv_tty_init</code>、<code>uv_tty_set_mode</code>等）均正常。</p>
<h4 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h4><p>经过全面测试，Neovim所需的所有libuv功能在HarmonyOS上正常工作：</p>
<ul>
<li>✅ 事件循环和定时器</li>
<li>✅ 文件系统操作</li>
<li>✅ TTY/终端功能（neovim TUI核心）</li>
<li>✅ 进程管理</li>
<li>✅ 系统信息获取</li>
</ul>
<h3 id="2-2-LuaJIT：JIT编译器的安全限制"><a href="#2-2-LuaJIT：JIT编译器的安全限制" class="headerlink" title="2.2 LuaJIT：JIT编译器的安全限制"></a>2.2 LuaJIT：JIT编译器的安全限制</h3><h4 id="挑战分析-1"><a href="#挑战分析-1" class="headerlink" title="挑战分析"></a>挑战分析</h4><p>LuaJIT在HarmonyOS上遇到<strong>W^X（Write XOR Execute）安全策略</strong>限制：</p>
<ol>
<li><strong><code>mmap(PROT_EXEC)</code>失败</strong>：无法分配可执行内存</li>
<li><strong><code>mprotect(RW → RX)</code>失败</strong>：无法设置内存执行权限</li>
<li><strong>JIT编译器完全不可用</strong></li>
</ol>
<h4 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h4><p><strong>禁用JIT功能</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译选项</span></span><br><span class="line">-DLUAJIT_DISABLE_JIT      <span class="comment"># 完全禁用JIT编译器</span></span><br><span class="line">-DLUAJIT_USE_SYSMALLOC    <span class="comment"># 使用系统内存分配器</span></span><br><span class="line">-DLJ_NO_SYSTEM            <span class="comment"># 限制系统调用（安全考虑）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>平台检测扩展</strong>：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在lj_arch.h中添加鸿蒙平台检测</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__OHOS__)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LUAJIT_OS          LUAJIT_OS_POSIX</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LJ_TARGET_OHOS     1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LJ_TARGET_CONSOLE  1      <span class="comment">// 控制台模式</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LUAJIT_DISABLE_JIT 1      <span class="comment">// JIT不可用</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LUAJIT_USE_SYSMALLOC 1    <span class="comment">// 系统分配器</span></span></span><br></pre></td></tr></table></figure></p>
<h4 id="性能影响"><a href="#性能影响" class="headerlink" title="性能影响"></a>性能影响</h4><p>虽然JIT不可用，但LuaJIT的解释器模式仍提供：</p>
<ul>
<li>完整的Lua 5.1语言兼容性</li>
<li>优于标准Lua 5.1的性能</li>
<li>稳定的内存管理</li>
</ul>
<h3 id="2-3-构建系统适配"><a href="#2-3-构建系统适配" class="headerlink" title="2.3 构建系统适配"></a>2.3 构建系统适配</h3><h4 id="挑战分析-2"><a href="#挑战分析-2" class="headerlink" title="挑战分析"></a>挑战分析</h4><p>不同依赖库使用不同的构建系统：</p>
<ul>
<li><strong>Autotools</strong>：libiconv</li>
<li><strong>Makefile</strong>：Lua、lpeg、LuaJIT</li>
<li><strong>CMake</strong>：tree-sitter、unibilium、utf8proc</li>
<li><strong>自定义构建</strong>：luv</li>
</ul>
<h4 id="统一构建方案"><a href="#统一构建方案" class="headerlink" title="统一构建方案"></a>统一构建方案</h4><p><strong>简化构建流程</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 旧流程（复杂）</span></span><br><span class="line">下载 → 解压 → 应用补丁 → 构建</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新流程（简化）</span></span><br><span class="line">下载 → 解压（已包含修改） → 构建</span><br></pre></td></tr></table></figure></p>
<p><strong>工具链统一配置</strong>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 鸿蒙BiSheng工具链</span></span><br><span class="line"><span class="built_in">export</span> CC=<span class="string">"/data/app/BiSheng.org/BiSheng_1.0/llvm/bin/clang"</span></span><br><span class="line"><span class="built_in">export</span> AR=<span class="string">"/data/app/BiSheng.org/BiSheng_1.0/llvm/bin/llvm-ar"</span></span><br><span class="line"><span class="built_in">export</span> RANLIB=<span class="string">"/data/app/BiSheng.org/BiSheng_1.0/llvm/bin/llvm-ranlib"</span></span><br><span class="line"><span class="built_in">export</span> STRIP=<span class="string">"/data/app/BiSheng.org/BiSheng_1.0/llvm/bin/llvm-strip"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-4-头文件与路径冲突"><a href="#2-4-头文件与路径冲突" class="headerlink" title="2.4 头文件与路径冲突"></a>2.4 头文件与路径冲突</h3><h4 id="luv的头文件路径问题"><a href="#luv的头文件路径问题" class="headerlink" title="luv的头文件路径问题"></a>luv的头文件路径问题</h4><p><strong>问题</strong>：luv依赖Lua 5.3兼容层，但头文件包含路径错误：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"compat-5.3.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"lua_compat53/compat-5.3.h"</span></span></span><br></pre></td></tr></table></figure></p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>修复源代码中的包含路径</li>
<li>添加编译标志避免.c文件包含：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-DCMAKE_C_FLAGS=<span class="string">"-DCOMPAT53_PREFIX=compat53"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-5-平台检测扩展"><a href="#2-5-平台检测扩展" class="headerlink" title="2.5 平台检测扩展"></a>2.5 平台检测扩展</h3><h4 id="libiconv的config-guess问题"><a href="#libiconv的config-guess问题" class="headerlink" title="libiconv的config.guess问题"></a>libiconv的config.guess问题</h4><p><strong>问题</strong>：Autotools的<code>config.guess</code>脚本无法识别HarmonyOS系统。</p>
<p><strong>解决方案</strong>：在<code>build-aux/config.guess</code>中添加HarmonyOS检测：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加系统检测分支</span></span><br><span class="line">HarmonyOS*:*:*:*)</span><br><span class="line">    <span class="built_in">echo</span> aarch64-unknown-harmonyos</span><br><span class="line">    <span class="built_in">exit</span> ;;</span><br></pre></td></tr></table></figure></p>
<h2 id="三、适配策略总结"><a href="#三、适配策略总结" class="headerlink" title="三、适配策略总结"></a>三、适配策略总结</h2><h3 id="3-1-渐进式适配策略"><a href="#3-1-渐进式适配策略" class="headerlink" title="3.1 渐进式适配策略"></a>3.1 渐进式适配策略</h3><ol>
<li><strong>功能验证优先</strong>：先测试核心功能，再完善边缘功能</li>
<li><strong>最小修改原则</strong>：只修改必要的部分，保持代码简洁</li>
<li><strong>条件编译为主</strong>：使用<code>#if !defined(__OHOS__)</code>包装平台特定代码</li>
<li><strong>桩函数补充</strong>：为缺失API提供简单实现</li>
</ol>
<h3 id="3-2-测试驱动开发"><a href="#3-2-测试驱动开发" class="headerlink" title="3.2 测试驱动开发"></a>3.2 测试驱动开发</h3><p>针对每个依赖库创建专门的测试程序：</p>
<ul>
<li><strong>libuv</strong>：<code>nvim-libuv-test.c</code>验证Neovim实际使用的功能</li>
<li><strong>LuaJIT</strong>：API可用性测试和性能基准测试</li>
<li><strong>综合测试</strong>：验证库间集成和兼容性</li>
</ul>
<h3 id="3-3-文档与补丁管理"><a href="#3-3-文档与补丁管理" class="headerlink" title="3.3 文档与补丁管理"></a>3.3 文档与补丁管理</h3><p><strong>补丁系统演进</strong>：</p>
<ol>
<li><strong>初期</strong>：使用patch文件管理修改</li>
<li><strong>中期</strong>：直接修改源码+Git版本控制</li>
<li><strong>当前</strong>：源码已包含修改，无需补丁应用步骤</li>
</ol>
<p><strong>文档完整性</strong>：</p>
<ul>
<li><code>PATCHES.md</code>：详细记录每个库的修改</li>
<li><code>libuv-porting-notes.md</code>：libuv移植全过程记录</li>
<li><code>luajit-harmonyos-api-analysis.md</code>：LuaJIT API限制分析</li>
</ul>
<h2 id="四、经验教训与最佳实践"><a href="#四、经验教训与最佳实践" class="headerlink" title="四、经验教训与最佳实践"></a>四、经验教训与最佳实践</h2><h3 id="4-1-关键经验"><a href="#4-1-关键经验" class="headerlink" title="4.1 关键经验"></a>4.1 关键经验</h3><ol>
<li><strong>平台差异深度分析</strong>：HarmonyOS不是简单的Linux变体，有独特的安全策略和API限制</li>
<li><strong>W^X安全策略影响</strong>：直接影响JIT编译器、代码生成等高级功能</li>
<li><strong>工具链兼容性</strong>：BiSheng Clang与GCC行为有细微差异</li>
<li><strong>文件系统限制</strong>：<code>/tmp</code>目录只读，影响临时文件处理</li>
</ol>
<h3 id="4-2-最佳实践"><a href="#4-2-最佳实践" class="headerlink" title="4.2 最佳实践"></a>4.2 最佳实践</h3><ol>
<li><strong>尽早验证核心API</strong>：在移植开始前测试<code>mmap</code>、<code>mprotect</code>等关键系统调用</li>
<li><strong>创建最小测试程序</strong>：隔离问题，快速验证假设</li>
<li><strong>对比官方实现</strong>：参考OpenHarmony的<code>ohos-libuv</code>等官方移植</li>
<li><strong>保持向上游兼容</strong>：条件编译优于直接修改，便于未来同步</li>
</ol>
<h3 id="4-3-调试技巧"><a href="#4-3-调试技巧" class="headerlink" title="4.3 调试技巧"></a>4.3 调试技巧</h3><ol>
<li><strong>构造函数调试</strong>：在平台文件中使用<code>__attribute__((constructor))</code>跟踪初始化</li>
<li><strong>环境变量诊断</strong>：检查<code>isatty()</code>、<code>uv_guess_handle()</code>等关键函数行为</li>
<li><strong>符号分析</strong>：使用<code>llvm-nm</code>分析库文件导出的符号</li>
<li><strong>分步构建测试</strong>：从简单功能开始，逐步增加复杂度</li>
</ol>
<h2 id="五、成果与展望"><a href="#五、成果与展望" class="headerlink" title="五、成果与展望"></a>五、成果与展望</h2><h3 id="5-1-移植成果"><a href="#5-1-移植成果" class="headerlink" title="5.1 移植成果"></a>5.1 移植成果</h3><p><strong>功能完整性</strong>：</p>
<ul>
<li>✅ Neovim核心编辑器功能</li>
<li>✅ 现代语法高亮（tree-sitter）</li>
<li>✅ Lua插件生态支持</li>
<li>✅ 异步I/O和事件处理</li>
<li>✅ 完整的终端用户界面</li>
</ul>
<p><strong>性能表现</strong>：</p>
<ul>
<li>LuaJIT解释器模式性能良好</li>
<li>libuv事件循环响应迅速</li>
<li>内存使用稳定可控</li>
</ul>
<h3 id="5-2-代码质量"><a href="#5-2-代码质量" class="headerlink" title="5.2 代码质量"></a>5.2 代码质量</h3><p><strong>补丁质量</strong>：</p>
<ul>
<li>所有修改都有详细文档记录</li>
<li>条件编译确保向上游兼容</li>
<li>测试覆盖核心功能场景</li>
</ul>
<p><strong>构建可靠性</strong>：</p>
<ul>
<li>100%构建成功率</li>
<li>支持增量构建和清理</li>
<li>完整的日志和错误处理</li>
</ul>
<h3 id="5-3-未来工作"><a href="#5-3-未来工作" class="headerlink" title="5.3 未来工作"></a>5.3 未来工作</h3><ol>
<li><strong>性能优化</strong>：进一步调优LuaJIT解释器性能</li>
<li><strong>网络功能</strong>：完善libuv网络套接字支持</li>
<li><strong>上游贡献</strong>：将稳定补丁贡献到各开源项目</li>
<li><strong>生态扩展</strong>：支持更多Lua插件和tree-sitter语法</li>
</ol>
<h2 id="六、结语"><a href="#六、结语" class="headerlink" title="六、结语"></a>六、结语</h2><p>Neovim在HarmonyOS PC上的成功移植，证明了复杂C/C++项目在鸿蒙生态中的可行性。通过系统性的平台差异分析、渐进式的适配策略和严谨的测试验证，我们克服了JIT内存限制、API差异、构建系统兼容性等多个技术挑战。</p>
<p>这次移植实践为其他复杂开源软件在HarmonyOS上的适配提供了宝贵经验：</p>
<ul>
<li><strong>平台差异的深度理解</strong>是成功的基础</li>
<li><strong>最小化修改和条件编译</strong>保持代码可维护性</li>
<li><strong>测试驱动的开发方法</strong>确保功能可靠性</li>
<li><strong>完整的文档记录</strong>便于知识传承和社区协作</li>
</ul>
<p>随着HarmonyOS PC生态的不断完善，期待更多优秀的开源软件能够在鸿蒙平台上焕发新的活力。</p>
<hr>
<p><strong>相关资源</strong>：</p>
<ul>
<li>项目仓库：<a href="https://gitcode.com/ystyle/neovim-harmonyos" target="_blank" rel="noopener">https://gitcode.com/ystyle/neovim-harmonyos</a></li>
<li>依赖构建系统：<a href="https://gitcode.com/ystyle/neovim-harmonyos-deps" target="_blank" rel="noopener">harmonyos-deps/</a></li>
<li>详细移植记录：<a href="https://gitcode.com/ystyle/neovim-harmonyos-deps/blob/master/libuv-porting-notes.md" target="_blank" rel="noopener">libuv-porting-notes.md</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2025-12-27T11:00:00.000Z" itemprop="dateUpdated">2025-12-27 19:00:00</time>
</span><br>


        
        本文链接：<a href="/2025/12/27/matebookpro-port-nvim-deps/" target="_blank" rel="external">http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/</a><br><span>博客内容遵循 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0协议</a></span>
        
    </div>
    <footer>
        <a href="http://ystyle.top">
            <img src="/img/avatar.jpg" alt="YSTYLE">
            YSTYLE
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/livub/">livub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/luajit/">luajit</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/matebook-pro/">matebook pro</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/neovim/">neovim</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鸿蒙/">鸿蒙</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/鸿蒙PC/">鸿蒙PC</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/&title=《Neovim移植鸿蒙PC：三方库适配实战与挑战解析》 — 东方星痕&pic=http://ystyle.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/&title=《Neovim移植鸿蒙PC：三方库适配实战与挑战解析》 — 东方星痕&source=请你给我力量，给我方向， 用风一样的翅膀，更用力的飞翔." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Neovim移植鸿蒙PC：三方库适配实战与挑战解析》 — 东方星痕&url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/&via=http://ystyle.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2025/12/27/matebookpro-run-cangjie-compiler/" id="post-next" class="post-nav-link">
        <div class="tips">下一篇 <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">鸿蒙PC Matebook Pro上安装仓颉编译器每日构建版</h4>
      </a>
    </div>
  
</nav>



    











<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '1f887c79a8b9b9fbec12',
          clientSecret: '05033003da5f8a5809b903806420690a665b0ea0',
          repo: 'ystyle.github.io',
          owner: 'ystyle',
          admin: ['ystyle'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="bottom">
        <p>
            

            <span>Power by <a href="http://ystyle.top/" target="_blank">东方星痕</a></span>
            <span>东方星痕 &copy; 2015 - 2025</span>
            <span><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021106688号-1</a></span>
            <div style="width:300px;margin:0 auto; padding:20px 0;">
              <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44010502002055" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
                <img src="/img/record-icon.png" style="float:left;"/>
                <p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">
                  粤公网安备 44010502002055号
                </p>
              </a>
            </div>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/&title=《Neovim移植鸿蒙PC：三方库适配实战与挑战解析》 — 东方星痕&pic=http://ystyle.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/&title=《Neovim移植鸿蒙PC：三方库适配实战与挑战解析》 — 东方星痕&source=请你给我力量，给我方向， 用风一样的翅膀，更用力的飞翔." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Neovim移植鸿蒙PC：三方库适配实战与挑战解析》 — 东方星痕&url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/&via=http://ystyle.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ystyle.top/2025/12/27/matebookpro-port-nvim-deps/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3aS46DMBAFwNz/0pkDoLHes2E02MUqChG4smj17/OJr+/lut69/nL8zfXzb9/cdmFgYLyW8R1eyeHGLx4/efy05GwYGBjnMH57fRIW1wPumDE+GwYGBkaewCW/zy8MDAyMdUYbfMewJDRjYGBgzAW+/O/In/94LY6BgfFCRt51//vPj8w3MDAwXsW4q7DM2/15MVycCgMDY2tGm/a1I8x2nLByHgwMjF0Zz61BtI22uVD++DYHBgbGv2HkKxErK1/5sdqUFAMDY2/G3CAzP0rLaAcSGBgYJzCSVC8vTZOQ/URoxsDA2JvxxARwbhVjpamHgYGxNyNve0UhL27PJX9lEdAxMDC2ZqwcOi9T7yp9lyaxGBgYr2XkRWbbys8XJvK70UIYBgbGdoyVplh+Nw/BbYMPAwPjBMZKcy0vTVdK3GJnBAMDY1NGOx5oVzHa0WY7TsDAwDiBsXLoPOwWhehcew4DA2NrRvvK9hFJoTv+vh2FYmBg7Mpoi9U2yVsZghYBFwMD4wBGHuxawErSWYRyDAyMAxhtW3/lEHPlaLFsgYGBsRHjW17teDIJ1nNpaD3TwMDAeC1jLhVreUmi2Ra9kzAMDIzXMlbWwpKC9t7VMQwMjJMZbZGZsNtR5Vzox8DAwMhbb3NN/7kU85PfwMDAOJKRJ4J5k64dIdwQcDEwMF7IyFO9vBmXs1cSRAwMjBMY7WJEHgrbddh21QMDA+MAxg/KjhkGC3LNqAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>






<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '东方星痕的博客';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎回来╮(╯▽╰)╭';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
